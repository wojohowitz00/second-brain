---
phase: 07-menu-bar-interface
plan: 01
type: implementation
wave: 1
depends_on: ["06-processing-integration"]
files_modified:
  - backend/_scripts/menu_bar_app.py
  - backend/tests/test_menu_bar_app.py
autonomous: true

must_haves:
  truths:
    - "Menu bar icon appears when app runs"
    - "Icon shows sync status (idle/syncing/error)"
    - "User can trigger manual sync from menu"
    - "User can view recent activity (last 5 notes)"
    - "User can quit app from menu"
  artifacts:
    - path: "backend/_scripts/menu_bar_app.py"
      provides: "MenuBarApp class with rumps-based menu bar interface"
      min_lines: 150
      exports: ["MenuBarApp", "run_menu_bar_app"]
    - path: "backend/tests/test_menu_bar_app.py"
      provides: "Unit tests for menu bar functionality"
      min_lines: 80
  key_links:
    - from: "backend/_scripts/menu_bar_app.py"
      to: "backend/_scripts/ollama_client.py"
      via: "import"
      pattern: "from ollama_client import"
    - from: "backend/_scripts/menu_bar_app.py"
      to: "backend/_scripts/vault_scanner.py"
      via: "import"
      pattern: "from vault_scanner import"
---

<objective>
Create a macOS menu bar application using rumps that displays sync status and provides user controls.

Purpose: Give users visual feedback and control over the Second Brain sync process without needing terminal access.

Output: Menu bar app with status icon, manual sync, recent activity, and quit functionality.
</objective>

<execution_context>
@/Users/richardyu/.claude/get-shit-done/workflows/execute-plan.md
@/Users/richardyu/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@backend/_scripts/ollama_client.py
@backend/_scripts/vault_scanner.py
@backend/_scripts/process_inbox.py
</context>

<feature>
  <name>MenuBarApp Core</name>
  <files>
    backend/_scripts/menu_bar_app.py
    backend/tests/test_menu_bar_app.py
  </files>
  <behavior>
    Menu bar application with:

    **Status Icons:**
    - üß† Idle (ready)
    - üîÑ Syncing (processing)
    - ‚ö†Ô∏è Error (Ollama down, vault issue)

    **Menu Structure:**
    - Status: "Second Brain - Idle"
    - ---
    - Sync Now (triggers manual sync)
    - Recent Activity ‚Üí
      - Note 1 (click opens in Obsidian)
      - Note 2
      - Note 3
      - Note 4
      - Note 5
    - ---
    - Settings... (opens config, future)
    - ---
    - Quit Second Brain

    Test cases (TDD - write tests FIRST):

    1. App creates menu bar item on init
    2. Default status is "idle"
    3. set_status("syncing") changes icon
    4. set_status("error") changes icon and shows message
    5. sync_now() triggers sync and updates status
    6. recent_activity returns last 5 filed notes
    7. clicking note opens Obsidian with that file
    8. quit() stops app cleanly
    9. health_check returns Ollama + vault status
    10. status reflects actual system health
  </behavior>
  <implementation>
    Create menu_bar_app.py with:

    1. Dependencies:
       ```
       pip install rumps
       ```

    2. MenuBarApp class:
       - __init__() - Create rumps.App with icon
       - set_status(status: str) - Update icon/title
       - sync_now() - Trigger manual sync
       - get_recent_activity() -> list[dict]
       - open_note(path: str) - Open in Obsidian
       - health_check() -> dict

    3. Status management:
       - Store current status (idle/syncing/error)
       - Recent activity stored in .state/recent_activity.json
       - Max 5 items, FIFO

    4. Obsidian integration:
       - Use `open` command with obsidian:// URL
       - Format: obsidian://open?vault=PARA&file={relative_path}

    5. Convenience function:
       - run_menu_bar_app() - Start the app

    Use @rumps.clicked decorators for menu actions.
    Threading for sync to not block UI.
  </implementation>
</feature>

<verification>
Run tests with verbose output:
```bash
cd /Users/richardyu/PARA/Personal/1_Projects/apps/second-brain/backend
uv run pytest tests/test_menu_bar_app.py -v --tb=short
```

Manual verification (requires macOS):
```bash
cd /Users/richardyu/PARA/Personal/1_Projects/apps/second-brain/backend
uv run python -c "
from menu_bar_app import MenuBarApp

app = MenuBarApp()
print('Menu bar app created successfully')
# Note: run_menu_bar_app() would start the event loop
"
```
</verification>

<success_criteria>
1. Tests written FIRST, fail initially (RED phase)
2. Menu bar icon appears on macOS
3. Status changes reflected in icon
4. Sync Now triggers processing
5. Recent Activity shows last 5 notes
6. Quit stops app cleanly
7. At least 10 test cases covering UI functionality
8. `uv run pytest tests/test_menu_bar_app.py -v` exits with code 0
</success_criteria>

<output>
After completion, create `.planning/phases/07-menu-bar-interface/07-01-SUMMARY.md`
</output>
